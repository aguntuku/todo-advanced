buildscript {
    repositories {
        mavenCentral()
    }

    dependencies {
        classpath 'org.gradle.api.plugins:gradle-cargo-plugin:0.5.9'
    }
}

apply plugin: org.gradle.api.plugins.cargo.CargoPlugin

dependencies {
    def cargoVersion = '1.3.3'
    cargo "org.codehaus.cargo:cargo-core-uberjar:$cargoVersion",
          "org.codehaus.cargo:cargo-ant:$cargoVersion"
}

task downloadBinaryArchive(type: com.manning.gia.BinaryDownload) {
	ext {
		repoPath = project.group.replaceAll('\\.', '/')
		repoBaseArtifactName = project(':web').war.baseName
		repoVersion = project.version.toString()
		repoArtifact = project(':web').war.archiveName
		binaryUrl = "$artifactoryContextUrl/simple/$artifactoryRepository/$repoPath/$repoBaseArtifactName/$repoVersion/$repoArtifact"
	}
	
	sourceUrl = binaryUrl
	targetBinary = file("$buildDir/$repoArtifact")	
}

cargoDeployRemote.dependsOn downloadBinaryArchive

ext.envTestHostname = 'localhost:8099'
ext.envTestUsername = 'manager'
ext.envTestPassword = 'manager'

cargo {
    containerId = 'tomcat7x'

    deployable {
	    file = file("${buildDir}/${project(':web').war.archiveName}")
        context = 'todo'
    }

    remote {
        hostname = envTestHostname
        username = envTestUsername
        password = envTestPassword
    }
}