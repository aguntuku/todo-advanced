apply plugin: 'maven'

ext.artifactoryUrl = 'http://localhost:8081/artifactory' 
ext.artifactoryUsername = 'admin'
ext.artifactoryPassword = 'password'
ext.artifactoryRepository = 'libs-release-local'

uploadArchives {		
    repositories.mavenDeployer {
        repository(url: "$artifactoryUrl/$artifactoryRepository") {
            authentication(userName: artifactoryUsername, password: artifactoryPassword)
        }
    }
}

ext.repoPath = project.group.replaceAll('.', '/')
ext.repoArtifact = project.name
ext.repoVersion = project.version.toString()
ext.artifact = "${repoArtifact}-${repoVersion}.war"
ext.downloadedArtifact = new File("$buildDir/$artifact")

task downloadBinaryArchive << {
	ext.binaryUrl = "$artifactoryUrl/simple/$artifactoryRepository/$repoPath/$repoArtifact/$repoVersion/$artifact"
	
	downloadedArtifact.withOutputStream { out ->
		out << new URL(binaryUrl).openStream()
	}
	
	assert downloadedArtifact.exists()
}